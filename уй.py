import json
import csv


player = {
    "имя": "Герой",
    "уровень": 1,
    "опыт": 0,
    "здоровье": 100,
    "атака": 10,
    "защита": 5,
    "экипировка": []
}


goblin = {
    "имя": "Гоблин",
    "здоровье": 50,
    "атака": 8,
    "защита": 2
}


boss = {
    "имя": "Босс",
    "здоровье": 200,
    "атака": 15,
    "защита": 10
}


def сохранить_прогресс():
    with open("прогресс.json", "w") as файл:
        json.dump(player, файл)


def загрузить_прогресс():
    global player
    with open("прогресс.json", "r") as файл:
        player = json.load(файл)


def удалить_прогресс():
    global player
    player = {
        "имя": "Герой",
        "уровень": 1,
        "опыт": 0,
        "здоровье": 100,
        "атака": 10,
        "защита": 5,
        "экипировка": []
    }
    сохранить_прогресс()


def записать_данные_в_csv():
    with open("данные.csv", "a", newline="") as файл:
        writer = csv.writer(файл)
        writer.writerow([player["имя"], player["уровень"], player["опыт"], player["здоровье"], player["атака"], player["защита"]])


def новый_бой():
    global player
    global goblin
    global boss
    
    print("Начинается новый бой!")
    while True:
        print("----------------------")
        print(f"{player['имя']} (Уровень {player['уровень']})")
        print(f"Здоровье: {player['здоровье']}")
        print(f"Атака: {player['атака']}")
        print(f"Защита: {player['защита']}")
        print("----------------------")
        if player['уровень'] % 5 == 0:  
            enemy = boss
        else:
            enemy = goblin
        print(f"{enemy['имя']}")
        print(f"Здоровье: {enemy['здоровье']}")
        print(f"Атака: {enemy['атака']}")
        print(f"Защита: {enemy['защита']}")
        print("----------------------")

        действие = input("Выберите действие (1 - Атаковать, 2 - Убежать, 3 - Выйти из игры): ")

        if действие == "1":  
           
            урон_игрока = max(0, player['атака'] - enemy['защита'])
            enemy['здоровье'] -= урон_игрока

      
            урон_врага = max(0, enemy['атака'] - player['защита'])
            player['здоровье'] -= урон_врага

            if enemy['здоровье'] <= 0:  
                print(f"{enemy['имя']} побежден!")
                player['опыт'] += 10
                if player['опыт'] >= player['уровень'] * 100:  
                    player['уровень'] += 1
                    player['атака'] += 5
                    player['защита'] += 2
                    print("Уровень повышен!")
                    сохранить_прогресс()
                if player['уровень'] == 20: 
                    print("Поздравляем! Вы победили всех гоблинов и боссов!")
                    записать_данные_в_csv()
                    break
                
                новый_бой()
            elif player['здоровье'] <= 0: 
                print(f"{player['имя']} погиб!")
                записать_данные_в_csv()
                break
        elif действие == "2": 
            print("Вы сбежали от врага")
            новый_бой()
        elif действие == "3":  
            print("Вы вышли из игры")
            записать_данные_в_csv()
            сохранить_прогресс()
            break
        else:
            print("Неверное действие, попробуйте еще раз!")


действие = input("Выберите действие (1 - Новая игра, 2 - Загрузить игру, 3 - Удалить сохранение): ")

if действие == "1":  
    новый_бой()
elif действие == "2":  
    загрузить_прогресс()
    новый_бой()
elif действие == "3":  
    удалить_прогресс()
    print("Сохранение удалено!")
    действие = input("Выберите действие (1 - Новая игра, 2 - выйти из игры): ")

if действие == "1":  
    новый_бой()
elif действие == "2":  
    записать_данные_в_csv()
    сохранить_прогресс()
    print("Вы вышли из игры")
    

else:
    print("Неверное действие, попробуйте еще раз!")
